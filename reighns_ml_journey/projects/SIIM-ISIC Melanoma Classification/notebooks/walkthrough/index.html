
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://reighns92.github.io/reighns-ml-blog/reighns_ml_journey/projects/SIIM-ISIC%20Melanoma%20Classification/notebooks/walkthrough/">
      
      <link rel="icon" href="../../../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.3.0, mkdocs-material-8.2.13">
    
    
      
        <title>SIIM-ISIC Melanoma Classification - Hongnan G. Machine Learning Blog</title>
      
    
    
      <link rel="stylesheet" href="../../../../../assets/stylesheets/main.e411adfe.min.css">
      
        
        <link rel="stylesheet" href="../../../../../assets/stylesheets/palette.cc9b2e1e.min.css">
        
      
    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../../../css/extra.css">
    
    <script>__md_scope=new URL("../../../../..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#siim-isic-melanoma-classification" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../../../.." title="Hongnan G. Machine Learning Blog" class="md-header__button md-logo" aria-label="Hongnan G. Machine Learning Blog" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Hongnan G. Machine Learning Blog
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              SIIM-ISIC Melanoma Classification
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../../.." title="Hongnan G. Machine Learning Blog" class="md-nav__button md-logo" aria-label="Hongnan G. Machine Learning Blog" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    Hongnan G. Machine Learning Blog
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../../.." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../../../about/" class="md-nav__link">
        About
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../../../articles.md" class="md-nav__link">
        How to write articles
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" >
      
      
      
      
        <label class="md-nav__link" for="__nav_4">
          Software Engineering Practices
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Software Engineering Practices" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Software Engineering Practices
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../software_engineering/workflow/" class="md-nav__link">
        Workflow
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../software_engineering/git/" class="md-nav__link">
        Git
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../software_engineering/code_design/" class="md-nav__link">
        Code Design
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../software_engineering/gcp/" class="md-nav__link">
        GCP
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../software_engineering/github_actions_test_packages_compatibility/" class="md-nav__link">
        Test Packages Compatibility
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../../mathematics/gradient_descent/" class="md-nav__link">
        Gradient Descent
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6" type="checkbox" id="__nav_6" >
      
      
      
      
        <label class="md-nav__link" for="__nav_6">
          Mathematics
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Mathematics" data-md-level="1">
        <label class="md-nav__title" for="__nav_6">
          <span class="md-nav__icon md-icon"></span>
          Mathematics
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../mathematics/general_mathematical_terms_and_definitions/" class="md-nav__link">
        General Mathematic Terms and Definitions
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6_2" type="checkbox" id="__nav_6_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_6_2">
          Linear Algebra
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Linear Algebra" data-md-level="2">
        <label class="md-nav__title" for="__nav_6_2">
          <span class="md-nav__icon md-icon"></span>
          Linear Algebra
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6_2_1" type="checkbox" id="__nav_6_2_1" >
      
      
      
      
        <label class="md-nav__link" for="__nav_6_2_1">
          Preliminaries
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Preliminaries" data-md-level="3">
        <label class="md-nav__title" for="__nav_6_2_1">
          <span class="md-nav__icon md-icon"></span>
          Preliminaries
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../mathematics/linear_algebra/01_preliminaries/lines_and_planes/" class="md-nav__link">
        Lines and Planes
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../mathematics/linear_algebra/01_preliminaries/fields/" class="md-nav__link">
        Fields
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6_2_2" type="checkbox" id="__nav_6_2_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_6_2_2">
          Vectors
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Vectors" data-md-level="3">
        <label class="md-nav__title" for="__nav_6_2_2">
          <span class="md-nav__icon md-icon"></span>
          Vectors
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../mathematics/linear_algebra/02_vectors/02_linear_algebra_vectors/" class="md-nav__link">
        Vector Operations
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6_2_2_2" type="checkbox" id="__nav_6_2_2_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_6_2_2_2">
          Vector Products
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Vector Products" data-md-level="4">
        <label class="md-nav__title" for="__nav_6_2_2_2">
          <span class="md-nav__icon md-icon"></span>
          Vector Products
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../mathematics/linear_algebra/02_vectors/02_linear_algebra_vectors_linear_combination/" class="md-nav__link">
        Linear Combination
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../mathematics/linear_algebra/02_vectors/02_linear_algebra_vectors_dot_product/" class="md-nav__link">
        Dot Product
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../mathematics/linear_algebra/02_vectors/02_linear_algebra_vectors_outer_product/" class="md-nav__link">
        Outer Product
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../mathematics/linear_algebra/02_vectors/02_linear_algebra_vectors_unit_vector/" class="md-nav__link">
        Unit Vector
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../mathematics/linear_algebra/02_vectors/02_linear_algebra_vectors_exercises/" class="md-nav__link">
        Exercises
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6_2_3" type="checkbox" id="__nav_6_2_3" >
      
      
      
      
        <label class="md-nav__link" for="__nav_6_2_3">
          Vector Spaces
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Vector Spaces" data-md-level="3">
        <label class="md-nav__title" for="__nav_6_2_3">
          <span class="md-nav__icon md-icon"></span>
          Vector Spaces
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../mathematics/linear_algebra/03_vector_spaces/03_linear_algebra_vector_spaces_vector_subspaces/" class="md-nav__link">
        Vector Space and Subspaces
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../mathematics/linear_algebra/03_vector_spaces/03_linear_algebra_vector_spaces_vector_span/" class="md-nav__link">
        Vector Span
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../mathematics/linear_algebra/03_vector_spaces/03_linear_algebra_vector_spaces_linear_independence/" class="md-nav__link">
        Linear Independence
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../mathematics/linear_algebra/03_vector_spaces/03_linear_algebra_vector_spaces_basis_dimension/" class="md-nav__link">
        Basis and Dimension
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6_2_4" type="checkbox" id="__nav_6_2_4" >
      
      
      
      
        <label class="md-nav__link" for="__nav_6_2_4">
          Matrix
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Matrix" data-md-level="3">
        <label class="md-nav__title" for="__nav_6_2_4">
          <span class="md-nav__icon md-icon"></span>
          Matrix
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../mathematics/linear_algebra/04_matrices/04_linear_algebra_matrix/" class="md-nav__link">
        Matrix
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../mathematics/linear_algebra/04_matrices/04_linear_algebra_matrix_basic_matrix_types/" class="md-nav__link">
        Basic Matrix Types
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../mathematics/linear_algebra/04_matrices/04_linear_algebra_matrix_basic_operations/" class="md-nav__link">
        Basic Matrix Operations
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../mathematics/linear_algebra/04_matrices/04_linear_algebra_matrix_multiplication/" class="md-nav__link">
        Matrix Multiplication
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6_2_5" type="checkbox" id="__nav_6_2_5" >
      
      
      
      
        <label class="md-nav__link" for="__nav_6_2_5">
          Matrix Theory
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Matrix Theory" data-md-level="3">
        <label class="md-nav__title" for="__nav_6_2_5">
          <span class="md-nav__icon md-icon"></span>
          Matrix Theory
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../mathematics/linear_algebra/05_system_of_linear_equations_and_matrix_theory/05.01_linear_algebra_systems_of_linear_equations/" class="md-nav__link">
        System of Linear Equations
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../mathematics/linear_algebra/05_system_of_linear_equations_and_matrix_theory/05.02_linear_algebra_row_reduction_preserves_rank/" class="md-nav__link">
        Row Reduction Preserves Rank
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../mathematics/linear_algebra/05_system_of_linear_equations_and_matrix_theory/05.03_linear_algebra_matrix_theory_matrix_spaces_row_space/" class="md-nav__link">
        Row Space
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../mathematics/linear_algebra/05_system_of_linear_equations_and_matrix_theory/05.04_linear_algebra_matrix_theory_matrix_spaces_column_space/" class="md-nav__link">
        Column Space
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../mathematics/linear_algebra/05_system_of_linear_equations_and_matrix_theory/05.05_linear_algebra_matrix_theory_matrix_spaces_right_nullspace/" class="md-nav__link">
        Right Nullspace (Kernel)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../mathematics/linear_algebra/05_system_of_linear_equations_and_matrix_theory/05.06_linear_algebra_matrix_theory_matrix_spaces_left_nullspace/" class="md-nav__link">
        Left Nullspace
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../mathematics/linear_algebra/05_system_of_linear_equations_and_matrix_theory/05.07_linear_algebra_matrix_theory_matrix_rank/" class="md-nav__link">
        Matrix Rank
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../mathematics/linear_algebra/05_system_of_linear_equations_and_matrix_theory/05.08_linear_algebra_matrix_theory_matrix_spaces_summary/" class="md-nav__link">
        The Four Fundamental Subspaces (Summary)
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6_2_6" type="checkbox" id="__nav_6_2_6" >
      
      
      
      
        <label class="md-nav__link" for="__nav_6_2_6">
          Linear Transformation
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Linear Transformation" data-md-level="3">
        <label class="md-nav__title" for="__nav_6_2_6">
          <span class="md-nav__icon md-icon"></span>
          Linear Transformation
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../mathematics/linear_algebra/06_linear_transformation/06.01_linear_algebra_linear_transformations/" class="md-nav__link">
        Linear Transformation
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../mathematics/linear_algebra/06_linear_transformation/06.02_linear_algebra_linear_transformations_nullspace/" class="md-nav__link">
        Nullspace
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../mathematics/linear_algebra/06_linear_transformation/06.03_linear_algebra_linear_transformations_ranges/" class="md-nav__link">
        Range
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../mathematics/linear_algebra/06_linear_transformation/06.04_linear_algebra_linear_transformations_homomorphism/" class="md-nav__link">
        Homomorphism
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../mathematics/linear_algebra/06_linear_transformation/06.05_linear_algebra_linear_transformations_fundamental_theorem/" class="md-nav__link">
        Fundamental Theorem
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../mathematics/linear_algebra/06_linear_transformation/06.06_linear_algebra_linear_transformations_matrix/" class="md-nav__link">
        Linear Transformation and Matrix
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6_2_7" type="checkbox" id="__nav_6_2_7" >
      
      
      
      
        <label class="md-nav__link" for="__nav_6_2_7">
          Analytic Geometry
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Analytic Geometry" data-md-level="3">
        <label class="md-nav__title" for="__nav_6_2_7">
          <span class="md-nav__icon md-icon"></span>
          Analytic Geometry
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../mathematics/linear_algebra/08_analytic_geometry/08.01_motivation/" class="md-nav__link">
        Motivation
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../mathematics/linear_algebra/08_analytic_geometry/08.02_norms/" class="md-nav__link">
        Norms
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../mathematics/linear_algebra/08_analytic_geometry/08.03_inner_products/" class="md-nav__link">
        Inner Product Spaces
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../mathematics/linear_algebra/08_analytic_geometry/08.04_lengths_and_distances/" class="md-nav__link">
        Lengths and Distances
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../mathematics/linear_algebra/08_analytic_geometry/08.05_angles_and_orthogonality/" class="md-nav__link">
        Angles and Orthogoanlity
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../mathematics/linear_algebra/08_analytic_geometry/08.06_orthogonal_subspaces/" class="md-nav__link">
        Orthogonal Subspace
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../mathematics/linear_algebra/08_analytic_geometry/08.07_orthogonal_projections/" class="md-nav__link">
        Orthogonal Projection
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../mathematics/linear_algebra/08_analytic_geometry/08.08_orthogonal_matrices_and_basis/" class="md-nav__link">
        Orthogonal Matrices and Basis
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../mathematics/linear_algebra/08_analytic_geometry/08.09_gram_schmidt_orthogonalization/" class="md-nav__link">
        Gram-Schmidt Orthogonalization
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../mathematics/linear_algebra/linear_algebra_interview_questions/" class="md-nav__link">
        Interview
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6_3" type="checkbox" id="__nav_6_3" >
      
      
      
      
        <label class="md-nav__link" for="__nav_6_3">
          Probability and Statistics
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Probability and Statistics" data-md-level="2">
        <label class="md-nav__title" for="__nav_6_3">
          <span class="md-nav__icon md-icon"></span>
          Probability and Statistics
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../mathematics/probability_statistics_theory/probability4datascience/" class="md-nav__link">
        Introduction to Probability for Data Science (Stanley H. Chan)
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6_3_2" type="checkbox" id="__nav_6_3_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_6_3_2">
          Introduction to Probability
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Introduction to Probability" data-md-level="3">
        <label class="md-nav__title" for="__nav_6_3_2">
          <span class="md-nav__icon md-icon"></span>
          Introduction to Probability
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../mathematics/probability_statistics_theory/02_introduction_to_probability/02.01_probability_space/" class="md-nav__link">
        Probability Space
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../mathematics/probability_statistics_theory/02_introduction_to_probability/02.02_probability_axioms/" class="md-nav__link">
        Probability Axioms
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../mathematics/probability_statistics_theory/02_introduction_to_probability/02.03_conditional_probability/" class="md-nav__link">
        Conditional Probability
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../mathematics/probability_statistics_theory/02_introduction_to_probability/02.04_independence/" class="md-nav__link">
        Independence
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../mathematics/probability_statistics_theory/02_introduction_to_probability/02.05_bayes_theorem/" class="md-nav__link">
        Bayes Theorem
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../mathematics/probability_statistics_theory/02_introduction_to_probability/02.06_summary/" class="md-nav__link">
        Summary
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7" type="checkbox" id="__nav_7" >
      
      
      
      
        <label class="md-nav__link" for="__nav_7">
          Machine Learning and Deep Learning
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Machine Learning and Deep Learning" data-md-level="1">
        <label class="md-nav__title" for="__nav_7">
          <span class="md-nav__icon md-icon"></span>
          Machine Learning and Deep Learning
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7_1" type="checkbox" id="__nav_7_1" >
      
      
      
      
        <label class="md-nav__link" for="__nav_7_1">
          Metrics
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Metrics" data-md-level="2">
        <label class="md-nav__title" for="__nav_7_1">
          <span class="md-nav__icon md-icon"></span>
          Metrics
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7_1_1" type="checkbox" id="__nav_7_1_1" >
      
      
      
      
        <label class="md-nav__link" for="__nav_7_1_1">
          Classification
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Classification" data-md-level="3">
        <label class="md-nav__title" for="__nav_7_1_1">
          <span class="md-nav__icon md-icon"></span>
          Classification
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../machine_learning_and_deep_learning/metrics/classification_metrics/classification_metrics/" class="md-nav__link">
        Introduction
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../machine_learning_and_deep_learning/metrics/classification_metrics/accuracy/" class="md-nav__link">
        Accuracy
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../machine_learning_and_deep_learning/metrics/classification_metrics/confusion_matrix/" class="md-nav__link">
        Confusion Matrix
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../machine_learning_and_deep_learning/metrics/classification_metrics/precision_recall_f1/" class="md-nav__link">
        Precision-Recall-F1
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../machine_learning_and_deep_learning/metrics/classification_metrics/roc_pr_curve/" class="md-nav__link">
        ROC and PR Curves
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../machine_learning_and_deep_learning/metrics/classification_metrics/cohens_kappa/" class="md-nav__link">
        Cohen's Kappa
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7_1_2" type="checkbox" id="__nav_7_1_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_7_1_2">
          Regression
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Regression" data-md-level="3">
        <label class="md-nav__title" for="__nav_7_1_2">
          <span class="md-nav__icon md-icon"></span>
          Regression
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../machine_learning_and_deep_learning/metrics/regression_metrics/regression_metrics/" class="md-nav__link">
        Introduction
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../machine_learning_and_deep_learning/metrics/regression_metrics/mae_rmse/" class="md-nav__link">
        MAE and MSE
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../machine_learning_and_deep_learning/metrics/regression_metrics/mape/" class="md-nav__link">
        MAPE
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7_2" type="checkbox" id="__nav_7_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_7_2">
          Computer Vision
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Computer Vision" data-md-level="2">
        <label class="md-nav__title" for="__nav_7_2">
          <span class="md-nav__icon md-icon"></span>
          Computer Vision
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../machine_learning_and_deep_learning/computer_vision/" class="md-nav__link">
        README
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7_2_2" type="checkbox" id="__nav_7_2_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_7_2_2">
          Neural Network Interpretation
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Neural Network Interpretation" data-md-level="3">
        <label class="md-nav__title" for="__nav_7_2_2">
          <span class="md-nav__icon md-icon"></span>
          Neural Network Interpretation
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7_2_2_1" type="checkbox" id="__nav_7_2_2_1" >
      
      
      
      
        <label class="md-nav__link" for="__nav_7_2_2_1">
          Visualization of Feature Map Activations
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Visualization of Feature Map Activations" data-md-level="4">
        <label class="md-nav__title" for="__nav_7_2_2_1">
          <span class="md-nav__icon md-icon"></span>
          Visualization of Feature Map Activations
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../machine_learning_and_deep_learning/computer_vision/neural_network_interpretation/01_feature_map_activation/feature_map_activation/" class="md-nav__link">
        Feature Map Activations (Part I)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../machine_learning_and_deep_learning/computer_vision/neural_network_interpretation/01_feature_map_activation/feature_map_activation_reduced/" class="md-nav__link">
        Feature Map Activations (Part II)
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../machine_learning_and_deep_learning/computer_vision/neural_network_interpretation/conv_filters/Visualizing Convolutional Filters.md" class="md-nav__link">
        Visualization of Convolutional Filters
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../machine_learning_and_deep_learning/computer_vision/neural_network_interpretation/salient_map/Salient Map.md" class="md-nav__link">
        Salient Map
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7_2_2_4" type="checkbox" id="__nav_7_2_2_4" >
      
      
      
      
        <label class="md-nav__link" for="__nav_7_2_2_4">
          Grad-CAM
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Grad-CAM" data-md-level="4">
        <label class="md-nav__title" for="__nav_7_2_2_4">
          <span class="md-nav__icon md-icon"></span>
          Grad-CAM
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../machine_learning_and_deep_learning/computer_vision/neural_network_interpretation/05_gradcam_and_variants/gradcam_explained/" class="md-nav__link">
        Grad-CAM Explained
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../machine_learning_and_deep_learning/computer_vision/neural_network_interpretation/05_gradcam_and_variants/gradcam_from_scratch/" class="md-nav__link">
        Grad-CAM from Scratch
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../machine_learning_and_deep_learning/computer_vision/image_normalization/Image_Normalization_and_Standardization/" class="md-nav__link">
        Image Normalization
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7_3" type="checkbox" id="__nav_7_3" >
      
      
      
      
        <label class="md-nav__link" for="__nav_7_3">
          Fundamental Concepts
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Fundamental Concepts" data-md-level="2">
        <label class="md-nav__title" for="__nav_7_3">
          <span class="md-nav__icon md-icon"></span>
          Fundamental Concepts
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../machine_learning_and_deep_learning/fundamentals/loss_functions/cross_entropy_loss/cross_entropy_loss_from_scratch/" class="md-nav__link">
        Cross Entropy Loss
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7_4" type="checkbox" id="__nav_7_4" >
      
      
      
      
        <label class="md-nav__link" for="__nav_7_4">
          Ensemble Theory
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Ensemble Theory" data-md-level="2">
        <label class="md-nav__title" for="__nav_7_4">
          <span class="md-nav__icon md-icon"></span>
          Ensemble Theory
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../machine_learning_and_deep_learning/ensemble_theory/forward_ensemble/" class="md-nav__link">
        Forward Ensemble (Hill Climbing)
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_8" type="checkbox" id="__nav_8" >
      
      
      
      
        <label class="md-nav__link" for="__nav_8">
          Data Structures and Algorithms
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Data Structures and Algorithms" data-md-level="1">
        <label class="md-nav__title" for="__nav_8">
          <span class="md-nav__icon md-icon"></span>
          Data Structures and Algorithms
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../data_structures_and_algorithms/introduction.md" class="md-nav__link">
        Introduction
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../data_structures_and_algorithms/Linked%20List/" class="md-nav__link">
        Linked Lists
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_9" type="checkbox" id="__nav_9" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_9">
          Machine Learning Projects
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Machine Learning Projects" data-md-level="1">
        <label class="md-nav__title" for="__nav_9">
          <span class="md-nav__icon md-icon"></span>
          Machine Learning Projects
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../RANZCR%20CLiP%20-%20Catheter%20and%20Line%20Position%20Challenge/notebooks/walkthrough/" class="md-nav__link">
        RANZCR CLiP - Catheter and Line Position Challenge
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          SIIM-ISIC Melanoma Classification
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        SIIM-ISIC Melanoma Classification
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#siim-isic-melanoma-classification" class="md-nav__link">
    SIIM-ISIC Melanoma Classification
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#establish-metrics" class="md-nav__link">
    Establish Metrics
  </a>
  
    <nav class="md-nav" aria-label="Establish Metrics">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#benefit-structure" class="md-nav__link">
    Benefit Structure
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#roc" class="md-nav__link">
    ROC
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#brier-score-loss" class="md-nav__link">
    Brier Score Loss
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#what-can-we-explore" class="md-nav__link">
    What can we explore?
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#validation-and-resampling-strategy" class="md-nav__link">
    Validation and Resampling Strategy
  </a>
  
    <nav class="md-nav" aria-label="Validation and Resampling Strategy">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#how-should-we-split-out-data-into-folds" class="md-nav__link">
    How should we split out data into folds?
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cross-validation-workflow" class="md-nav__link">
    Cross-Validation Workflow
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#transfer-learning" class="md-nav__link">
    Transfer Learning
  </a>
  
    <nav class="md-nav" aria-label="Transfer Learning">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#fine-tuning" class="md-nav__link">
    Fine-Tuning
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#feature-extraction" class="md-nav__link">
    Feature Extraction
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#preprocessing" class="md-nav__link">
    Preprocessing
  </a>
  
    <nav class="md-nav" aria-label="Preprocessing">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mean-and-standard-deviation" class="md-nav__link">
    Mean and Standard Deviation
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#channel-distribution" class="md-nav__link">
    Channel Distribution
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#let-the-model-tell-you-where-went-wrong" class="md-nav__link">
    Let the Model tell you where went wrong!
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#augmentations" class="md-nav__link">
    Augmentations
  </a>
  
    <nav class="md-nav" aria-label="Augmentations">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#train-time-augmentation" class="md-nav__link">
    Train-Time Augmentation
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test-time-augmentation" class="md-nav__link">
    Test-Time Augmentation
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#optimizer-scheduler-and-loss" class="md-nav__link">
    Optimizer, Scheduler and Loss
  </a>
  
    <nav class="md-nav" aria-label="Optimizer, Scheduler and Loss">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#optimizer" class="md-nav__link">
    Optimizer
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scheduler" class="md-nav__link">
    Scheduler
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#loss" class="md-nav__link">
    Loss
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#model-architectures-training-parameters" class="md-nav__link">
    Model Architectures, Training Parameters
  </a>
  
    <nav class="md-nav" aria-label="Model Architectures, Training Parameters">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#no-meta-data-model-architecture" class="md-nav__link">
    No Meta Data Model Architecture
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#meta-data-model-architecture" class="md-nav__link">
    Meta Data Model Architecture
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#activation-functions" class="md-nav__link">
    Activation Functions
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ensemble-theory" class="md-nav__link">
    Ensemble Theory
  </a>
  
    <nav class="md-nav" aria-label="Ensemble Theory">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mean-blending" class="md-nav__link">
    Mean Blending
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#forward-ensembling" class="md-nav__link">
    Forward Ensembling
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#error-analysis-using-grad-cam" class="md-nav__link">
    Error Analysis using Grad-CAM
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#next-steps" class="md-nav__link">
    Next Steps
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#references" class="md-nav__link">
    References
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../LTA_road_cracks_detection/notebooks/walkthrough/" class="md-nav__link">
        LTA
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_9_4" type="checkbox" id="__nav_9_4" >
      
      
      
      
        <label class="md-nav__link" for="__nav_9_4">
          Breast Cancer Wisconsin (Supervised Classification)
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Breast Cancer Wisconsin (Supervised Classification)" data-md-level="2">
        <label class="md-nav__title" for="__nav_9_4">
          <span class="md-nav__icon md-icon"></span>
          Breast Cancer Wisconsin (Supervised Classification)
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../breast_cancer_wisconsin/Stage%200%20-%20Introduction%20and%20Problem%20Statement/" class="md-nav__link">
        Introduction
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../breast_cancer_wisconsin/Stage%201%20-%20Preliminary%20Data%20Inspection%20and%20Cleaning/" class="md-nav__link">
        Preliminary Data Inspection and Cleaning
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../breast_cancer_wisconsin/Stage%202%20-%20Preliminary%20EDA/" class="md-nav__link">
        EDA
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../breast_cancer_wisconsin/Stage%203%20-%20Feature%20Engineering/" class="md-nav__link">
        Feature Engineering
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../breast_cancer_wisconsin/Stage%204%20-%20Modelling%20%28Metric%20to%20Optimize%29/" class="md-nav__link">
        Modelling (Metrics)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../breast_cancer_wisconsin/Stage%205%20-%20Modelling%20%28Cross-Validation%20Methodology%29/" class="md-nav__link">
        Modelling (Cross-Validation Schema)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../breast_cancer_wisconsin/Stage%206%20-%20Modelling%20%28Preprocessing%20and%20Spot%20Checking%29/" class="md-nav__link">
        Modelling (Preprocessing and Spot Checking)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../breast_cancer_wisconsin/Stage%207%20-%20Modelling%20%28Model%20Selection%20and%20Hyperparameter%20Tuning%29/" class="md-nav__link">
        Modelling (Model Selection)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../breast_cancer_wisconsin/Stage%208%20-%20Modelling%20%28Model%20Evaluation%20and%20Interpretation%29/" class="md-nav__link">
        Modelling (Model Evaluation)
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#siim-isic-melanoma-classification" class="md-nav__link">
    SIIM-ISIC Melanoma Classification
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#establish-metrics" class="md-nav__link">
    Establish Metrics
  </a>
  
    <nav class="md-nav" aria-label="Establish Metrics">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#benefit-structure" class="md-nav__link">
    Benefit Structure
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#roc" class="md-nav__link">
    ROC
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#brier-score-loss" class="md-nav__link">
    Brier Score Loss
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#what-can-we-explore" class="md-nav__link">
    What can we explore?
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#validation-and-resampling-strategy" class="md-nav__link">
    Validation and Resampling Strategy
  </a>
  
    <nav class="md-nav" aria-label="Validation and Resampling Strategy">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#how-should-we-split-out-data-into-folds" class="md-nav__link">
    How should we split out data into folds?
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cross-validation-workflow" class="md-nav__link">
    Cross-Validation Workflow
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#transfer-learning" class="md-nav__link">
    Transfer Learning
  </a>
  
    <nav class="md-nav" aria-label="Transfer Learning">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#fine-tuning" class="md-nav__link">
    Fine-Tuning
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#feature-extraction" class="md-nav__link">
    Feature Extraction
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#preprocessing" class="md-nav__link">
    Preprocessing
  </a>
  
    <nav class="md-nav" aria-label="Preprocessing">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mean-and-standard-deviation" class="md-nav__link">
    Mean and Standard Deviation
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#channel-distribution" class="md-nav__link">
    Channel Distribution
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#let-the-model-tell-you-where-went-wrong" class="md-nav__link">
    Let the Model tell you where went wrong!
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#augmentations" class="md-nav__link">
    Augmentations
  </a>
  
    <nav class="md-nav" aria-label="Augmentations">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#train-time-augmentation" class="md-nav__link">
    Train-Time Augmentation
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test-time-augmentation" class="md-nav__link">
    Test-Time Augmentation
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#optimizer-scheduler-and-loss" class="md-nav__link">
    Optimizer, Scheduler and Loss
  </a>
  
    <nav class="md-nav" aria-label="Optimizer, Scheduler and Loss">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#optimizer" class="md-nav__link">
    Optimizer
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scheduler" class="md-nav__link">
    Scheduler
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#loss" class="md-nav__link">
    Loss
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#model-architectures-training-parameters" class="md-nav__link">
    Model Architectures, Training Parameters
  </a>
  
    <nav class="md-nav" aria-label="Model Architectures, Training Parameters">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#no-meta-data-model-architecture" class="md-nav__link">
    No Meta Data Model Architecture
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#meta-data-model-architecture" class="md-nav__link">
    Meta Data Model Architecture
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#activation-functions" class="md-nav__link">
    Activation Functions
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ensemble-theory" class="md-nav__link">
    Ensemble Theory
  </a>
  
    <nav class="md-nav" aria-label="Ensemble Theory">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mean-blending" class="md-nav__link">
    Mean Blending
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#forward-ensembling" class="md-nav__link">
    Forward Ensembling
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#error-analysis-using-grad-cam" class="md-nav__link">
    Error Analysis using Grad-CAM
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#next-steps" class="md-nav__link">
    Next Steps
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#references" class="md-nav__link">
    References
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                


  <h1>SIIM-ISIC Melanoma Classification</h1>

<h2 id="siim-isic-melanoma-classification">SIIM-ISIC Melanoma Classification</h2>
<p>This competition is hosted on Kaggle and the <a href="https://www.kaggle.com/c/siim-isic-melanoma-classification/overview">description and overview is stated below</a>.</p>
<p>Skin cancer is the most prevalent type of cancer. Melanoma, specifically, is responsible for 75% of skin cancer deaths, despite being the least common skin cancer. The American Cancer Society estimates over 100,000 new melanoma cases will be diagnosed in 2020. It's also expected that almost 7,000 people will die from the disease. As with other cancers, early and accurate detection—potentially aided by data science—can make treatment more effective.</p>
<p>Currently, dermatologists evaluate every one of a patient's moles to identify outlier lesions or “ugly ducklings” that are most likely to be melanoma. Existing AI approaches have not adequately considered this clinical frame of reference. Dermatologists could enhance their diagnostic accuracy if detection algorithms take into account “contextual” images within the same patient to determine which images represent a melanoma. If successful, classifiers would be more accurate and could better support dermatological clinic work.</p>
<p>As the leading healthcare organization for informatics in medical imaging, the Society for Imaging Informatics in Medicine (SIIM)'s mission is to advance medical imaging informatics through education, research, and innovation in a multi-disciplinary community. SIIM is joined by the International Skin Imaging Collaboration (ISIC), an international effort to improve melanoma diagnosis. The ISIC Archive contains the largest publicly available collection of quality-controlled dermoscopic images of skin lesions.</p>
<p>In this competition, you’ll identify melanoma in images of skin lesions. In particular, you’ll use images within the same patient and determine which are likely to represent a melanoma. Using patient-level contextual information may help the development of image analysis tools, which could better support clinical dermatologists.</p>
<p>Melanoma is a deadly disease, but if caught early, most melanomas can be cured with minor surgery. Image analysis tools that automate the diagnosis of melanoma will improve dermatologists' diagnostic accuracy. Better detection of melanoma has the opportunity to positively impact millions of people.</p>
<h2 id="establish-metrics">Establish Metrics</h2>
<p>After understanding the problem better, we should probably define a metric to optimize. As usual, this step should be closely tied to business problem. We were already given a metric score by the competition host and let us understand it better.</p>
<p>Recall that we wish to have a well-calibrated model, the intuition is that a high performance model may not output meaningful probabilities, even if they can have extremely good performance score.</p>
<p>Consider a model that outputs logits of <span class="arithmatex">\(0.51\)</span> when y_true is 1 and <span class="arithmatex">\(0.49\)</span> otherwise, then a decision threshold of <span class="arithmatex">\(0.5\)</span> guarantees an accuracy of <span class="arithmatex">\(100\%\)</span>, we have no complaints here if we have no issue with our threshold if our only goal is to have a high scoring model. However, if in medical case, where doctor wants to understand "probablistically" the survival of a patient, then we might want to turn into logits probs. But apparently the example here holds almost no meaning, when compared to a "well calibrated model", more concretely.</p>
<div class="highlight"><pre><span></span><code><span class="n">y_true</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
<span class="n">y_prob_uncalibrated</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.49</span><span class="p">,</span> <span class="mf">0.49</span><span class="p">,</span> <span class="mf">0.51</span><span class="p">,</span> <span class="mf">0.51</span><span class="p">]</span>
<span class="n">y_prob_calibrated</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.45</span><span class="p">,</span> <span class="mf">0.99</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">]</span>
</code></pre></div>
<p>both models give <span class="arithmatex">\(100\%\)</span> accuracy, but the latter (assuming calibrated), can give us a laymen idea that ok this patient has 0.99 chance and the other patient 0.6 chance of surviving etc.</p>
<h3 id="benefit-structure">Benefit Structure</h3>
<p>One can introduce a <strong>benefit structure</strong> with relevant cost-benefit assignment.</p>
<ul>
<li>TP: + 100</li>
<li>FN: -1000</li>
<li>FP: -10</li>
<li>TP+FP: -1 (screening for example)</li>
</ul>
<p>With each TP, we net a profit of 100, and with each FN, we lose -1000, FP loses -10 and whenever the patient get predicted to die (1), send for further screening -1. So towards the end, we can have:</p>
<div class="arithmatex">\[
cost = 100*TP - 1000 * FN - 10 * FP - 1 * (TP+FP)
\]</div>
<p>This structure helps us decide which metrics to choose.</p>
<h3 id="roc">ROC</h3>
<p>Definition: The basic (non-probablistic intepretation) of ROC is graph that plots the True Positive Rate on the y-axis and False Positive Rate on the x-axis parametrized by a threshold vector <code>t</code>. We then look at the area under the ROC curve (AUROC) to get an overall performance measure. Note that TPR is <code>recall</code>.</p>
<ul>
<li>TPR (recall) = TP / (TP + FN)</li>
<li>FPR = FP / (FP + TN)</li>
<li>Threshold invariant<ul>
<li>The ROC looks at the performance of a model hypothesis at all thresholds. This is better than just optimizing <strong>recall</strong> which only looks at a fixed threshold.</li>
</ul>
</li>
<li>
<p>Scale Invariant</p>
<ul>
<li>
<p>Not necessarily a good thing in this context, as this makes ROC a semi-proper scoring metric, that is, it takes in non-calibrated scores and perform well. <strong>The below code shows that as long as the order is preserved, <code>y2</code> and <code>y4</code> make zero difference in the outcome. In this case, the doctor may not be able to have a “confidence” level of how likely the patient is going to survive.</strong></p>
<div class="highlight"><pre><span></span><code><span class="n">y1</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
<span class="n">y2</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.52</span><span class="p">,</span><span class="mf">0.51</span><span class="p">,</span><span class="mf">0.52</span><span class="p">,</span><span class="mf">0.51</span><span class="p">]</span>
<span class="n">y3</span> <span class="o">=</span> <span class="p">[</span><span class="mi">52</span><span class="p">,</span><span class="mi">51</span><span class="p">,</span><span class="mi">52</span><span class="p">,</span><span class="mi">51</span><span class="p">]</span>
<span class="n">y4</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.99</span><span class="p">,</span> <span class="mf">0.51</span><span class="p">,</span> <span class="mf">0.98</span><span class="p">,</span> <span class="mf">0.51</span><span class="p">]</span>
<span class="n">uncalibrated_roc</span> <span class="o">=</span> <span class="n">roc</span><span class="p">(</span><span class="n">y1</span><span class="p">,</span><span class="n">y2</span><span class="p">)</span> <span class="o">==</span> <span class="n">roc</span><span class="p">(</span><span class="n">y1</span><span class="p">,</span><span class="n">y3</span><span class="p">)</span> <span class="o">==</span> <span class="n">roc</span><span class="p">(</span><span class="n">y1</span><span class="p">,</span> <span class="n">y4</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">uncalibrated_roc</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="mf">1.0</span>
</code></pre></div>
</li>
<li>
<p>This brings us to the next point.</p>
</li>
</ul>
</li>
</ul>
<p>More info in notebook.</p>
<h3 id="brier-score-loss">Brier Score Loss</h3>
<p>Brier Score computes the squared difference between the probability of a prediction and its actual outcome. Intuitively, this score punishes “unconfident and neutral” probability logits. If a model consistently spits out probability that is near 0.5, then this score will be large. </p>
<ul>
<li>Proper scoring<ul>
<li>Tells us if the scores output are well calibrated.</li>
<li>If not well calibrated, prompt us to either use a different model that calibrated well, or to perform calibration on the model itself.</li>
<li>Logistic regression produces natural well calibrated probabilities since it optimizes the log-loss (ce loss), in fact, I think MLE models should always produce well calibrated probabilities since behind the scene it is minimizing KL divergence between ground truth distribution P and estimated distribution Q.</li>
<li>It follows that models like DT do not produce well calibrated probabilities.</li>
</ul>
</li>
</ul>
<p>More info in notebook.</p>
<h3 id="what-can-we-explore">What can we explore?</h3>
<ul>
<li>Did not provide insight if Precision-recall curve and if it may be well posed for this problem than ROC since there is some class imbalance.</li>
<li>Did not go into details on calibration methods, in fact, models like RF are not well calibrated by construction. <a href="https://scikit-learn.org/stable/modules/calibration.html">https://scikit-learn.org/stable/modules/calibration.html</a></li>
</ul>
<h2 id="validation-and-resampling-strategy">Validation and Resampling Strategy</h2>
<h3 id="how-should-we-split-out-data-into-folds">How should we split out data into folds?</h3>
<p>We should examine the data for a few factors:</p>
<ol>
<li>Is the data <span class="arithmatex">\(\mathcal{X}\)</span> imbalanced?</li>
<li>Is the data <span class="arithmatex">\(\mathcal{X}\)</span> generated in a <strong>i.i.d.</strong> manner, more specifically, if I split <span class="arithmatex">\(\mathcal{X}\)</span> to <span class="arithmatex">\(\mathcal{X}_{train}\)</span> and <span class="arithmatex">\(\mathcal{X}_{val}\)</span>, can we ensure that <span class="arithmatex">\(\mathcal{X}_{val}\)</span> has no dependency on <span class="arithmatex">\(\mathcal{X}_{train}\)</span>?</li>
</ol>
<p>We came to the conclusion:</p>
<ol>
<li>
<p>Yes, the data is severely imbalanced in which there are only around <span class="arithmatex">\(2\%\)</span> of positive (malignant) samples. Therefore, a stratified cross validation is reasonable. <code>StratifiedKFold</code> ensures that relative class frequencies is approximately preserved in each train and validation fold. More concretely, we will not experience the scenario where <span class="arithmatex">\(X_{train}\)</span> has <span class="arithmatex">\(m^{+}\)</span> and <span class="arithmatex">\(m^{-}\)</span> positive and negative samples, but <span class="arithmatex">\(X_{val}\)</span> has only <span class="arithmatex">\(p^{+}\)</span> positive samples only and 0 negative samples, simply due to the scarcity of negative samples.</p>
</li>
<li>
<p>In medical imaging, it is a well known fact that most of the data contains patient level repeatedly. To put it bluntly, if I have 100 samples, and according to <strong>PatientID</strong>, we see that the id 123456 (John Doe) appeared 20 times, this is normal as a patient can undergo multiple settings of say, X-rays. If we allow John Doe's data to appear in both train and validation set, then this poses a problem of information leakage, in which the data is no longer <strong>i.i.d.</strong>. One can think of each patient has an "unique, underlying features" which are highly correlated across their different samples. As a result, it is paramount to ensure that amongst this 3255 unique patients, we need to ensure that each unique patients' images <strong>DO NOT</strong> appear in the validation fold. That is to say, if patient John Doe has 100 X-ray images, but during our 5-fold splits, he has 70 images in Fold 1-4, while 30 images are in Fold 5, then if we were to train on Fold 1-4 and validate on Fold 5, there may be potential leakage and the model will predict with confidence for John Doe's images. This is under the assumption that John Doe's data does not fulfill the i.i.d proces</p>
</li>
</ol>
<hr />
<p>With the above consideration, we will use <code>StratifiedGroupKFold</code> where <span class="arithmatex">\(K = 5\)</span> splits. There wasn't this splitting function in scikit-learn at the time of competition and as a result, we used a custom written (by someone else) <code>RepeatedStratifiedGroupKFold</code> function and just set <code>n_splits = 1</code> to get <strong>StratifiedGroupKFold</strong> (yes we cannot afford to repeated sample, so setting the split to be 1 will collapse the repeated function to just the normal stratified group kfold). However, as of 2022, this function is readily available in the <strong>Scikit-Learn</strong> library.</p>
<p>To recap, we applied stratified logic such that each train and validation set has an <strong>equal</strong> weightage of positive and negative samples. We also grouped the patients in the process such that patient <span class="arithmatex">\(i\)</span> will not appear in both training and validation set.</p>
<hr />
<blockquote>
<p>It is worth mentioning the famous Kaggler Chris Deotte went one step further to <strong>Triple Stratify</strong> the data where he balanced patient count distribution. One can read more <a href="https://www.kaggle.com/c/siim-isic-melanoma-classification/discussion/165526">here</a>.</p>
</blockquote>
<hr />
<h3 id="cross-validation-workflow">Cross-Validation Workflow</h3>
<p>To recap, we have the following:</p>
<ul>
<li><strong>Training Set (<span class="arithmatex">\(X_{\text{train}}\)</span>)</strong>: This will be further split into K validation sets during our cross-validation. This set is used to fit a particular hypothesis <span class="arithmatex">\(h \in \mathcal{H}\)</span>.</li>
<li><strong>Validation Set (<span class="arithmatex">\(X_{\text{val}}\)</span>)</strong>: This is split from our <span class="arithmatex">\(X_{\text{train}}\)</span> during cross-validation. This set is used for model selection (i.e. find best hyperparameters, attempt to produce a best hypothesis <span class="arithmatex">\(g \in \mathcal{H}\)</span>).</li>
<li><strong>Test Set (<span class="arithmatex">\(X_{\text{test}}\)</span>)</strong>: This is an unseen test set, and we will only use it after we finish tuning our model/hypothesis. Suppose we have a final best model <span class="arithmatex">\(g\)</span>, we will use <span class="arithmatex">\(g\)</span> to predict on the test set to get an estimate of the generalization error (also called out-of-sample error).</li>
</ul>
<figure>
<img src='https://storage.googleapis.com/reighns/reighns_ml_projects/docs/supervised_learning/classification/aiap-coronary-artery-disease/data/images/cv.PNG' width="500"/>
<figcaption align = "center"><b>Pipeline.</b></figcaption>
</figure>

<hr />
<figure>
<img src='https://storage.googleapis.com/reighns/reighns_ml_projects/docs/supervised_learning/classification/breast-cancer-wisconsin/data/images/grid_search_workflow.png' width="500"/>
<figcaption align = "center"><b>Courtesy of scikit-learn on a typical Cross-Validation workflow.</b></figcaption>
</figure>

<h2 id="transfer-learning">Transfer Learning</h2>
<p>Traditionally, training on <strong>ImageNet</strong> weights is a good choice to start. In the event that our training set has a very different distribution of what's inside <strong>ImageNet</strong>, the model may take a while to converge, even if we finetune it. The intuition is simple, <strong>ImageNet</strong> was trained on many common items in life, and none of them resemble closely to the image structures of <strong>Melanoma Images</strong>. Consequently, the model may have a hard time detecting shapes and details from these medical images.</p>
<p>We can of course unfreeze all the layers and retrain them from scratch, using various backbones, however, due to limited hardware, we decided it is best to first check if <strong>ImageNet</strong> yields good results, if not, we can explore weights that were originally trained on skin cancer images. </p>
<p>The community used a few models and found out that the <strong>EfficientNet</strong> variants yielded the best results on this set of training images using <strong>ImageNet</strong> and hence we adopt the <strong>EfficientNet</strong> family moving forward. Examining the Grad-CAM of the models revealed that this family of models not only focus on the center nucleus of the skin image but also corners, perhaps they capture something other models don't? We will compare them briefly later.</p>
<h3 id="fine-tuning">Fine-Tuning</h3>
<p>Instead of random initialization, we initialize the network with a pretrained network, like the one that is trained on imagenet 1000 dataset. This is what we will be doing. References below.</p>
<h3 id="feature-extraction">Feature Extraction</h3>
<p>ConvNet as fixed feature extractor: Here, we will freeze the weights for all of the network except that of the final fully connected layer. This last fully connected layer is replaced with a new one with random weights and only this layer is trained.</p>
<h2 id="preprocessing">Preprocessing</h2>
<p>Most preprocessing techniques we do in an image recognition competition is mostly as follows:</p>
<h3 id="mean-and-standard-deviation">Mean and Standard Deviation</h3>
<ul>
<li>Perform <strong>mean and std</strong> for the dataset given to us. Note that this step may make sense on paper, but empirically, using imagenet's default mean std will always work as well, if not better. You can read my <a href="https://reighns92.github.io/reighns-ml-blog/reighns_ml_journey/deep_learning/computer_vision/general/image_normalization/Image_Normalization_and_Standardization/">blog post here</a>"<ul>
<li>Imagenet on RGB: mean = [0.485, 0.456, 0.406] and std = [0.229, 0.224, 0.225]</li>
</ul>
</li>
</ul>
<h3 id="channel-distribution">Channel Distribution</h3>
<p>This is usually done to check for "surprises". More specifically, I remembered once that someone trained a CNN on the blood cells dataset (red, white blood cells etc), as a beginner who just came out from MNIST, he/she grayscaled the images and yielded poor results. This is because one distinct way for the model to differentiate these cells might be because of the colors of the cells.</p>
<h3 id="let-the-model-tell-you-where-went-wrong">Let the Model tell you where went wrong!</h3>
<p>Alternatively, the issues are not obvious and we can use tools like Grad-CAM to see where our model is looking to deduce why the model is performing poorly.</p>
<h2 id="augmentations">Augmentations</h2>
<p>We know that augmentation is central in an image competition, as essentially we are adding more data into the training process, effectively reducing overfitting.</p>
<p>Heavy augmentations are used during Train-Time-Augmentation. But during Test-Time-Augmentation, we used the same set of training augmentations to inference with <span class="arithmatex">\(100\%\)</span> probability.</p>
<h3 id="train-time-augmentation">Train-Time Augmentation</h3>
<p>Community power. We made use of some innovative augmentations:</p>
<ul>
<li><a href="https://www.kaggle.com/c/siim-isic-melanoma-classification/discussion/159176">AdvancedHairAugmentation</a> where hairs were randomly added to the image and</li>
<li><a href="https://www.kaggle.com/c/siim-isic-melanoma-classification/discussion/159476">Microscope</a> where images were made to look as if they were taken from a microscope.</li>
</ul>
<p>Both of these augmentations provided a steady increase in CV and LB.</p>
<div class="highlight"><pre><span></span><code><span class="n">albumentations</span><span class="o">.</span><span class="n">Compose</span><span class="p">(</span>
    <span class="p">[</span>
        <span class="n">AdvancedHairAugmentation</span><span class="p">(</span>
            <span class="n">hairs_folder</span><span class="o">=</span><span class="n">pipeline_config</span><span class="o">.</span><span class="n">transforms</span><span class="o">.</span><span class="n">hairs_folder</span>
        <span class="p">),</span>
        <span class="n">albumentations</span><span class="o">.</span><span class="n">RandomResizedCrop</span><span class="p">(</span>
            <span class="n">height</span><span class="o">=</span><span class="n">pipeline_config</span><span class="o">.</span><span class="n">transforms</span><span class="o">.</span><span class="n">image_size</span><span class="p">,</span>
            <span class="n">width</span><span class="o">=</span><span class="n">pipeline_config</span><span class="o">.</span><span class="n">transforms</span><span class="o">.</span><span class="n">image_size</span><span class="p">,</span>
            <span class="n">scale</span><span class="o">=</span><span class="p">(</span><span class="mf">0.8</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span>
            <span class="n">ratio</span><span class="o">=</span><span class="p">(</span><span class="mf">0.75</span><span class="p">,</span> <span class="mf">1.3333333333333333</span><span class="p">),</span>
            <span class="n">p</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
        <span class="p">),</span>
        <span class="n">albumentations</span><span class="o">.</span><span class="n">VerticalFlip</span><span class="p">(</span><span class="n">p</span><span class="o">=</span><span class="mf">0.5</span><span class="p">),</span>
        <span class="n">albumentations</span><span class="o">.</span><span class="n">HorizontalFlip</span><span class="p">(</span><span class="n">p</span><span class="o">=</span><span class="mf">0.5</span><span class="p">),</span>
        <span class="n">albumentations</span><span class="o">.</span><span class="n">Cutout</span><span class="p">(</span>
            <span class="n">max_h_size</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">pipeline_config</span><span class="o">.</span><span class="n">transforms</span><span class="o">.</span><span class="n">image_size</span> <span class="o">*</span> <span class="mf">0.375</span><span class="p">),</span>
            <span class="n">max_w_size</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">pipeline_config</span><span class="o">.</span><span class="n">transforms</span><span class="o">.</span><span class="n">image_size</span> <span class="o">*</span> <span class="mf">0.375</span><span class="p">),</span>
            <span class="n">num_holes</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">p</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span>
        <span class="p">),</span>
        <span class="n">Microscope</span><span class="p">(</span><span class="n">p</span><span class="o">=</span><span class="mf">0.5</span><span class="p">),</span>
        <span class="n">albumentations</span><span class="o">.</span><span class="n">Normalize</span><span class="p">(</span>
            <span class="n">mean</span><span class="o">=</span><span class="n">pipeline_config</span><span class="o">.</span><span class="n">transforms</span><span class="o">.</span><span class="n">mean</span><span class="p">,</span>
            <span class="n">std</span><span class="o">=</span><span class="n">pipeline_config</span><span class="o">.</span><span class="n">transforms</span><span class="o">.</span><span class="n">std</span><span class="p">,</span>
            <span class="n">max_pixel_value</span><span class="o">=</span><span class="mf">255.0</span><span class="p">,</span>
            <span class="n">p</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
        <span class="p">),</span>
        <span class="n">ToTensorV2</span><span class="p">(</span><span class="n">p</span><span class="o">=</span><span class="mf">1.0</span><span class="p">),</span>
    <span class="p">]</span>
<span class="p">)</span>
</code></pre></div>
<h3 id="test-time-augmentation">Test-Time Augmentation</h3>
<p>The exact same set of augmentations were used in inference. Not all TTAs provided a increase in score.</p>
<h2 id="optimizer-scheduler-and-loss">Optimizer, Scheduler and Loss</h2>
<h3 id="optimizer">Optimizer</h3>
<p>We used good old <code>AdamW</code> keeping in mind the rule of thumb that if batch size increase by a factor of 2, learning rate should increase by a factor of 2 as well.</p>
<div class="highlight"><pre><span></span><code><span class="n">optimizer_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;AdamW&quot;</span>
<span class="n">optimizer_params</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span>
    <span class="n">default_factory</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;lr&quot;</span><span class="p">:</span> <span class="mf">1e-4</span><span class="p">,</span>
        <span class="s2">&quot;betas&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">0.9</span><span class="p">,</span> <span class="mf">0.999</span><span class="p">),</span>
        <span class="s2">&quot;amsgrad&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
        <span class="s2">&quot;weight_decay&quot;</span><span class="p">:</span> <span class="mf">1e-6</span><span class="p">,</span>
        <span class="s2">&quot;eps&quot;</span><span class="p">:</span> <span class="mf">1e-08</span><span class="p">,</span>
    <span class="p">}</span>
<span class="p">)</span>
</code></pre></div>
<h3 id="scheduler">Scheduler</h3>
<p>We used the following settings:</p>
<div class="highlight"><pre><span></span><code><span class="n">scheduler_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;CosineAnnealingWarmRestarts&quot;</span>  <span class="c1"># Debug</span>
<span class="k">if</span> <span class="n">scheduler_name</span> <span class="o">==</span> <span class="s2">&quot;CosineAnnealingWarmRestarts&quot;</span><span class="p">:</span>
    <span class="n">scheduler_params</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span>
        <span class="n">default_factory</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;T_0&quot;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
            <span class="s2">&quot;T_mult&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
            <span class="s2">&quot;eta_min&quot;</span><span class="p">:</span> <span class="mf">1e-6</span><span class="p">,</span>
            <span class="s2">&quot;last_epoch&quot;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
        <span class="p">}</span>
    <span class="p">)</span>
</code></pre></div>
<p>One should note that <code>OneCycleLR</code> is very popular and yields good results with shorter convergence time.</p>
<h3 id="loss">Loss</h3>
<p>We used <code>CrossEntropyLoss</code> loss with default parameters. Read more in my <a href="https://reighns92.github.io/reighns-ml-blog/reighns_ml_journey/deep_learning/fundamentals/loss_functions/cross_entropy_loss/cross_entropy_loss_from_scratch/">blog post</a>.</p>
<div class="highlight"><pre><span></span><code><span class="n">train_criterion_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;CrossEntropyLoss&quot;</span>
<span class="n">train_criterion_params</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span>
    <span class="n">default_factory</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;weight&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
        <span class="s2">&quot;size_average&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
        <span class="s2">&quot;ignore_index&quot;</span><span class="p">:</span> <span class="o">-</span><span class="mi">100</span><span class="p">,</span>
        <span class="s2">&quot;reduce&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
        <span class="s2">&quot;reduction&quot;</span><span class="p">:</span> <span class="s2">&quot;mean&quot;</span><span class="p">,</span>
        <span class="s2">&quot;label_smoothing&quot;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
    <span class="p">}</span>
<span class="p">)</span>
</code></pre></div>
<h2 id="model-architectures-training-parameters">Model Architectures, Training Parameters</h2>
<h3 id="no-meta-data-model-architecture">No Meta Data Model Architecture</h3>
<p>For models that did not make use of meta data, we have the following architecture.</p>
<figure>
<img src='https://storage.googleapis.com/reighns/reighns_ml_projects/docs/projects/SIIM-ISIC%20Melanoma%20Classification/images/no_meta_model_architecure.svg' width="800"/>
<figcaption align = "center"><b>No Meta Data Model Architecture.</b></figcaption>
</figure>

<h3 id="meta-data-model-architecture">Meta Data Model Architecture</h3>
<p>For models that did made use of meta data, we have the following architecture.</p>
<figure>
<img src='https://storage.googleapis.com/reighns/reighns_ml_projects/docs/projects/SIIM-ISIC%20Melanoma%20Classification/images/meta_model_architecture.svg' width="800"/>
<figcaption align = "center"><b>Meta Data Model Architecture.</b></figcaption>
</figure>

<p>We concat the flattened feature maps with the meta features: </p>
<div class="highlight"><pre><span></span><code><span class="n">Meta</span> <span class="n">Features</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;sex&#39;</span><span class="p">,</span> <span class="s1">&#39;age_approx&#39;</span><span class="p">,</span> <span class="s1">&#39;site_head/neck&#39;</span><span class="p">,</span> <span class="s1">&#39;site_lower extremity&#39;</span><span class="p">,</span> <span class="s1">&#39;site_oral/genital&#39;</span><span class="p">,</span> <span class="s1">&#39;site_palms/soles&#39;</span><span class="p">,</span> <span class="s1">&#39;site_torso&#39;</span><span class="p">,</span> <span class="s1">&#39;site_upper extremity&#39;</span><span class="p">,</span> <span class="s1">&#39;site_nan&#39;</span><span class="p">]</span>
</code></pre></div>
<p>and the meta features has its own sequential layers as ANN:</p>
<div class="highlight"><pre><span></span><code><span class="n">OrderedDict</span><span class="p">(</span>
    <span class="p">[</span>
        <span class="p">(</span>
            <span class="s2">&quot;fc1&quot;</span><span class="p">,</span>
            <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_meta_features</span><span class="p">,</span> <span class="mi">512</span><span class="p">),</span>
        <span class="p">),</span>
        <span class="p">(</span>
            <span class="s2">&quot;bn1&quot;</span><span class="p">,</span>
            <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">BatchNorm1d</span><span class="p">(</span><span class="mi">512</span><span class="p">),</span>
        <span class="p">),</span>
        <span class="p">(</span>
            <span class="s2">&quot;swish1&quot;</span><span class="p">,</span>
            <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">SiLU</span><span class="p">(),</span>
        <span class="p">),</span>
        <span class="p">(</span>
            <span class="s2">&quot;dropout1&quot;</span><span class="p">,</span>
            <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Dropout</span><span class="p">(</span><span class="n">p</span><span class="o">=</span><span class="mf">0.3</span><span class="p">),</span>
        <span class="p">),</span>
        <span class="p">(</span>
            <span class="s2">&quot;fc2&quot;</span><span class="p">,</span>
            <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="mi">512</span><span class="p">,</span> <span class="mi">128</span><span class="p">),</span>
        <span class="p">),</span>
        <span class="p">(</span>
            <span class="s2">&quot;bn2&quot;</span><span class="p">,</span>
            <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">BatchNorm1d</span><span class="p">(</span><span class="mi">128</span><span class="p">),</span>
        <span class="p">),</span>
        <span class="p">(</span>
            <span class="s2">&quot;swish2&quot;</span><span class="p">,</span>
            <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">SiLU</span><span class="p">(),</span>
        <span class="p">),</span>
    <span class="p">]</span>
<span class="p">)</span>
</code></pre></div>
<p>For example:</p>
<ul>
<li>image shape: <span class="arithmatex">\([32, 3, 256, 256]\)</span></li>
<li>meta_inputs shape: <span class="arithmatex">\([32, 9]\)</span> we have 9 features.</li>
<li>feature_logits shape: <span class="arithmatex">\([32, 1280]\)</span> flattened feature maps at the last conv layer.</li>
<li>meta_logits shape: <span class="arithmatex">\([32, 128]\)</span> where we passed in a small sequential ANN for the meta data.</li>
<li>concat_logits shape: <span class="arithmatex">\([32, 1280 + 128]\)</span></li>
</ul>
<div class="highlight"><pre><span></span><code><span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_meta</span><span class="p">:</span>
    <span class="c1"># from cnn images</span>
    <span class="n">feature_logits</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">extract_features</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>

    <span class="c1"># from meta features</span>
    <span class="n">meta_logits</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta_layer</span><span class="p">(</span><span class="n">meta_inputs</span><span class="p">)</span>

    <span class="c1"># concatenate</span>
    <span class="n">concat_logits</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">((</span><span class="n">feature_logits</span><span class="p">,</span> <span class="n">meta_logits</span><span class="p">),</span> <span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="c1"># classifier head</span>
    <span class="n">classifier_logits</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">architecture</span><span class="p">[</span><span class="s2">&quot;head&quot;</span><span class="p">](</span><span class="n">concat_logits</span><span class="p">)</span>
</code></pre></div>
<h3 id="activation-functions">Activation Functions</h3>
<p>As we all know, activation functions are used to transform a neurons' linearity to non-linearity and decide whether to "fire" a neuron or not.</p>
<p>When we design or choose an activation function, we need to ensure the follows:</p>
<ul>
<li>
<p>(Smoothness) Differentiable and Continuous: For example, the sigmoid function is continuous and hence differentiable. If the property is not fulfilled, we might face issues as backpropagation may not be performed properly since we cannot differentiate it.If you notice, the heaviside function is not. We cant perform GD using the HF as we cannot compute gradients but for the logistic function we can. The gradient of sigmoid function g is g(1-g) conveniently</p>
</li>
<li>
<p>Monotonic: This helps the model to converge faster. But spoiler alert, Swish is not monotonic.</p>
</li>
</ul>
<p>The properties of Swish are as follows:</p>
<ul>
<li>Bounded below: It is claimed in the paper it serves as a strong regularization.</li>
<li>Smoothness: More smooth than ReLU which allows the model to optimize better, the error landscape, when smoothed, is easier to traverse in order to find a minima. An intuitive idea is the hill again, imagine you traverse down your neighbourhood hill, vs traversing down Mount Himalaya.</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="c1"># Import matplotlib, numpy and math</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">math</span>

<span class="k">def</span> <span class="nf">swish</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="n">sigmoid</span> <span class="o">=</span>  <span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="p">))</span>
    <span class="n">swish</span> <span class="o">=</span> <span class="n">x</span> <span class="o">*</span> <span class="n">sigmoid</span>
    <span class="k">return</span> <span class="n">swish</span>

<span class="n">epsilon</span> <span class="o">=</span> <span class="mf">1e-20</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">100</span><span class="p">,</span><span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">z</span> <span class="o">=</span> <span class="n">swish</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">z</span><span class="p">))</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Swish(X)&quot;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div>
<h2 id="ensemble-theory">Ensemble Theory</h2>
<h3 id="mean-blending">Mean Blending</h3>
<p>This is just simple mean blending.</p>
<h3 id="forward-ensembling">Forward Ensembling</h3>
<p>We made use of the <a href="https://www.kaggle.com/c/siim-isic-melanoma-classification/discussion/175614">Forward Ensembling</a> idea from Chris in SIIM-ISIC Melanoma Classification back in August 2020, I modified the code for this specific task. A simple description is as follows, modified from Chris, with more mathematical notations.</p>
<ol>
<li>We start off with a dataset <span class="arithmatex">\(\mathcal{D} = X \times y\)</span> where it is sampled from the true population <span class="arithmatex">\(\mathcal{X} \times \mathcal{Y}\)</span>.</li>
<li>We apply KFold (5 splits) to the dataset, as illustrated in the diagram. </li>
<li>We can now train five different hypothesis <span class="arithmatex">\(h_{F1}, h_{F2},...,h_{F5}\)</span>, where <span class="arithmatex">\(h_{F1}\)</span> is trained on Fold 2 to Fold 5 and predict on Fold 1, <span class="arithmatex">\(h_{F2}\)</span> is trained on Fold 1,3,4,5 and predict on Fold 2. The logic follows for all 5 hypothesis.</li>
<li>Notice that in the five models, we are predicting on a unique validation fold, and as a result, after we trained all 5 folds, we will have the predictions made on the whole training set (F1-F5). This predictions is called the Out-of-Fold predictions.</li>
<li>We then go a step further and calculate the AUC score with the OOF predictions with the ground truth to get the OOF AUC. We save it to a csv or dataframe called <strong>oof_1.csv</strong>, subsequent oof trained on different hypothesis space should be named <strong>oof_i.csv</strong> where <span class="arithmatex">\(i \in [2,3,...]\)</span>.</li>
<li>After we trained all 5 folds, we will use <span class="arithmatex">\(h_{1}\)</span> to predict on <span class="arithmatex">\(X_{test}\)</span> and obtain predictions <span class="arithmatex">\(Y_{\text{h1 preds}}\)</span>, we then use <span class="arithmatex">\(h_{2}\)</span> to predict on <span class="arithmatex">\(X_{test}\)</span> and obtain predictions <span class="arithmatex">\(Y_{\text{h2 preds}}\)</span>, we do this for all five folds and finally <span class="arithmatex">\(Y_{\text{final preds}} = \dfrac{1}{5}\sum_{i=1}^{5}Y_{\text{hi preds}}\)</span>. This is a typical pipeline in most machine learning problems. We save this final predictions as <strong>sub_1.csv</strong>, subsequence predictions trained on different hypothesis space should be named <strong>sub_i.csv</strong> where <span class="arithmatex">\(i \in [2,3,...]\)</span>.</li>
<li>Now if we train another model, a completely different hypothesis space is used, to be more pedantic, we denote the previous model to be taken from the hypothesis space <span class="arithmatex">\(\mathcal{H}_{1}\)</span>, and now we move on to <span class="arithmatex">\(\mathcal{H}_{2}\)</span>. We repeat step 1-6 on this new model (Note that you are essentially training 10 "models" now since we are doing KFold twice, and oh, please set the seed of KFold to be the same, it should never be the case that both model comes from different splitting seed for apparent reasons).</li>
</ol>
<hr />
<p>Here is the key (given the above setup with 2 different models trained on 5 folds):</p>
<ol>
<li>Normally, most people do a simple mean ensemble, that is <span class="arithmatex">\(\dfrac{Y_{\text{final preds H1}} + Y_{\text{final preds H2}}}{2}\)</span>. This works well most of the time as we trust both model holds equal importance in the final predictions.</li>
<li>One issue may be that certain models should be weighted more than the rest, we should not simply take Leaderboard feedback score to judge the weight assignment. A general heuristic here is called Forward Selection.</li>
<li>(Extracted from Chris) Now say that you build 2 models (that means that you did 5 KFold twice). You now have oof_1.csv, oof_2.csv, sub_1.csv, and sub_2.csv. How do we blend the two models? We find the weight w such that <code>w * oof_1.predictions + (1-w) * oof_2.predictions</code> has the largest AUC.</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="nb">all</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="p">[</span><span class="mf">0.00</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.02</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="mf">0.98</span><span class="p">,</span> <span class="mf">0.99</span><span class="p">,</span> <span class="mf">1.00</span><span class="p">]:</span>
    <span class="n">ensemble_pred</span> <span class="o">=</span> <span class="n">w</span> <span class="o">*</span> <span class="n">oof_1</span><span class="o">.</span><span class="n">predictions</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">w</span><span class="p">)</span> <span class="o">*</span> <span class="n">oof_2</span><span class="o">.</span><span class="n">predictions</span>
    <span class="n">ensemble_auc</span> <span class="o">=</span> <span class="n">roc_auc_score</span><span class="p">(</span> <span class="n">oof</span><span class="o">.</span><span class="n">target</span> <span class="p">,</span> <span class="n">ensemble_pred</span> <span class="p">)</span>
    <span class="nb">all</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">ensemble_auc</span> <span class="p">)</span>
<span class="n">best_weight</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span> <span class="nb">all</span> <span class="p">)</span> <span class="o">/</span> <span class="mf">100.</span>
</code></pre></div>
<p>Then we can assign the best weight like:</p>
<div class="highlight"><pre><span></span><code><span class="n">final_ensemble_pred</span> <span class="o">=</span> <span class="n">best_weight</span> <span class="o">*</span> <span class="n">sub_1</span><span class="o">.</span><span class="n">target</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">best_weight</span><span class="p">)</span> <span class="o">*</span> <span class="n">sub_2</span><span class="o">.</span><span class="n">target</span>
</code></pre></div>
<p>Read more from my blog post in references below.</p>
<div class="highlight"><pre><span></span><code><span class="err">!</span><span class="n">pip</span> <span class="n">install</span> <span class="n">torchinfo</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>Collecting torchinfo
  Downloading torchinfo-1.6.3-py3-none-any.whl (20 kB)
Installing collected packages: torchinfo
Successfully installed torchinfo-1.6.3


WARNING: You are using pip version 21.3.1; however, version 22.0.3 is available.
You should consider upgrading via the &#39;C:\Users\reighns\AppData\Local\Microsoft\WindowsApps\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\python.exe -m pip install --upgrade pip&#39; command.
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">timm</span>
<span class="kn">from</span> <span class="nn">dataclasses</span> <span class="kn">import</span> <span class="n">asdict</span><span class="p">,</span> <span class="n">dataclass</span><span class="p">,</span> <span class="n">field</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Union</span>
<span class="kn">import</span> <span class="nn">torchinfo</span>
<span class="kn">import</span> <span class="nn">torch</span>
<span class="c1"># Utility functions.</span>
<span class="kn">import</span> <span class="nn">gc</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span><span class="p">,</span> <span class="n">PurePath</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Union</span><span class="p">,</span> <span class="n">List</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">torch</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">seed_all</span><span class="p">(</span><span class="n">seed</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1992</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Seed all random number generators.&quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Using Seed Number </span><span class="si">{</span><span class="n">seed</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;PYTHONHASHSEED&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
        <span class="n">seed</span>
    <span class="p">)</span>  <span class="c1"># set PYTHONHASHSEED env var at fixed value</span>
    <span class="n">torch</span><span class="o">.</span><span class="n">manual_seed</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>
    <span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">manual_seed_all</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>
    <span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">manual_seed</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>  <span class="c1"># pytorch (both CPU and CUDA)</span>
    <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>  <span class="c1"># for numpy pseudo-random generator</span>
    <span class="c1"># set fixed value for python built-in pseudo-random generator</span>
    <span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>
    <span class="n">torch</span><span class="o">.</span><span class="n">backends</span><span class="o">.</span><span class="n">cudnn</span><span class="o">.</span><span class="n">deterministic</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">torch</span><span class="o">.</span><span class="n">backends</span><span class="o">.</span><span class="n">cudnn</span><span class="o">.</span><span class="n">benchmark</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">torch</span><span class="o">.</span><span class="n">backends</span><span class="o">.</span><span class="n">cudnn</span><span class="o">.</span><span class="n">enabled</span> <span class="o">=</span> <span class="kc">False</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">seed_all</span><span class="p">()</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>Using Seed Number 1992
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">ModelParams</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;A class to track model parameters.</span>

<span class="sd">    model_name (str): name of the model.</span>
<span class="sd">    pretrained (bool): If True, use pretrained model.</span>
<span class="sd">    input_channels (int): RGB image - 3 channels or Grayscale 1 channel</span>
<span class="sd">    output_dimension (int): Final output neuron.</span>
<span class="sd">                      It is the number of classes in classification.</span>
<span class="sd">                      Caution: If you use sigmoid layer for Binary, then it is 1.</span>
<span class="sd">    classification_type (str): classification type.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">model_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;resnet50d&quot;</span>  <span class="c1"># resnet50d resnext50_32x4d &quot;tf_efficientnet_b0_ns&quot;  # Debug use tf_efficientnet_b0_ns else tf_efficientnet_b4_ns vgg16</span>

    <span class="n">pretrained</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">input_channels</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3</span>
    <span class="n">output_dimension</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">classification_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;multiclass&quot;</span>
    <span class="n">use_meta</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">to_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Convert to dictionary.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">asdict</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">MODEL_PARAMS</span> <span class="o">=</span> <span class="n">ModelParams</span><span class="p">()</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">CustomNeuralNet</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">model_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">MODEL_PARAMS</span><span class="o">.</span><span class="n">model_name</span><span class="p">,</span>
        <span class="n">out_features</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">MODEL_PARAMS</span><span class="o">.</span><span class="n">output_dimension</span><span class="p">,</span>
        <span class="n">in_channels</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">MODEL_PARAMS</span><span class="o">.</span><span class="n">input_channels</span><span class="p">,</span>
        <span class="n">pretrained</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">MODEL_PARAMS</span><span class="o">.</span><span class="n">pretrained</span><span class="p">,</span>
        <span class="n">use_meta</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">MODEL_PARAMS</span><span class="o">.</span><span class="n">use_meta</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Construct a new model.</span>

<span class="sd">        Args:</span>
<span class="sd">            model_name ([type], str): The name of the model to use. Defaults to MODEL_PARAMS.model_name.</span>
<span class="sd">            out_features ([type], int): The number of output features, this is usually the number of classes, but if you use sigmoid, then the output is 1. Defaults to MODEL_PARAMS.output_dimension.</span>
<span class="sd">            in_channels ([type], int): The number of input channels; RGB = 3, Grayscale = 1. Defaults to MODEL_PARAMS.input_channels.</span>
<span class="sd">            pretrained ([type], bool): If True, use pretrained model. Defaults to MODEL_PARAMS.pretrained.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">in_channels</span> <span class="o">=</span> <span class="n">in_channels</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pretrained</span> <span class="o">=</span> <span class="n">pretrained</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">use_meta</span> <span class="o">=</span> <span class="n">use_meta</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">backbone</span> <span class="o">=</span> <span class="n">timm</span><span class="o">.</span><span class="n">create_model</span><span class="p">(</span>
            <span class="n">model_name</span><span class="p">,</span> <span class="n">pretrained</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">pretrained</span><span class="p">,</span> <span class="n">in_chans</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">in_channels</span>
        <span class="p">)</span>

        <span class="c1"># removes head from backbone: # TODO: Global pool = &quot;avg&quot; vs &quot;&quot; behaves differently in shape, caution!</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">backbone</span><span class="o">.</span><span class="n">reset_classifier</span><span class="p">(</span><span class="n">num_classes</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">global_pool</span><span class="o">=</span><span class="s2">&quot;avg&quot;</span><span class="p">)</span>

        <span class="c1"># get the last layer&#39;s number of features in backbone (feature map)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">in_features</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">backbone</span><span class="o">.</span><span class="n">num_features</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">out_features</span> <span class="o">=</span> <span class="n">out_features</span>

        <span class="c1"># Custom Head</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">single_head_fc</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Sequential</span><span class="p">(</span>
            <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">in_features</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">out_features</span><span class="p">),</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">architecture</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Callable</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;backbone&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">backbone</span><span class="p">,</span>
            <span class="s2">&quot;bottleneck&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
            <span class="s2">&quot;head&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">single_head_fc</span><span class="p">,</span>
        <span class="p">}</span>

    <span class="k">def</span> <span class="nf">extract_features</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">FloatTensor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">FloatTensor</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Extract the features mapping logits from the model.</span>
<span class="sd">        This is the output from the backbone of a CNN.</span>

<span class="sd">        Args:</span>
<span class="sd">            image (torch.FloatTensor): The input image.</span>

<span class="sd">        Returns:</span>
<span class="sd">            feature_logits (torch.FloatTensor): The features logits.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># TODO: To rename feature_logits to image embeddings, also find out what is image embedding.</span>
        <span class="n">feature_logits</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">architecture</span><span class="p">[</span><span class="s2">&quot;backbone&quot;</span><span class="p">](</span><span class="n">image</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;feature logits shape = </span><span class="si">{</span><span class="n">feature_logits</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">feature_logits</span>

    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">FloatTensor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">FloatTensor</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;The forward call of the model.</span>

<span class="sd">        Args:</span>
<span class="sd">            image (torch.FloatTensor): The input image.</span>

<span class="sd">        Returns:</span>
<span class="sd">            classifier_logits (torch.FloatTensor): The output logits of the classifier head.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">feature_logits</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">extract_features</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
        <span class="n">classifier_logits</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">architecture</span><span class="p">[</span><span class="s2">&quot;head&quot;</span><span class="p">](</span><span class="n">feature_logits</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;classifier_logits shape = </span><span class="si">{</span><span class="n">classifier_logits</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">classifier_logits</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">model</span> <span class="o">=</span> <span class="n">CustomNeuralNet</span><span class="p">()</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">batch_size</span><span class="p">,</span> <span class="n">channel</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">width</span> <span class="o">=</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">256</span><span class="p">,</span> <span class="mi">256</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">X</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">randn</span><span class="p">((</span><span class="n">batch_size</span><span class="p">,</span> <span class="n">channel</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">width</span><span class="p">))</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="n">image</span><span class="o">=</span><span class="n">X</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>feature logits shape = torch.Size([8, 2048])
classifier_logits shape = torch.Size([8, 2])
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">_</span> <span class="o">=</span> <span class="n">torchinfo</span><span class="o">.</span><span class="n">summary</span><span class="p">(</span>
    <span class="n">model</span><span class="p">,</span>
    <span class="p">(</span><span class="n">batch_size</span><span class="p">,</span> <span class="n">channel</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">width</span><span class="p">),</span>
    <span class="n">col_names</span><span class="o">=</span><span class="p">[</span>
        <span class="s2">&quot;input_size&quot;</span><span class="p">,</span>
        <span class="s2">&quot;output_size&quot;</span><span class="p">,</span>
        <span class="s2">&quot;num_params&quot;</span><span class="p">,</span>
        <span class="s2">&quot;kernel_size&quot;</span><span class="p">,</span>
        <span class="s2">&quot;mult_adds&quot;</span><span class="p">,</span>
    <span class="p">],</span>
    <span class="n">depth</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
    <span class="n">verbose</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>torch.Size([8, 2048])
torch.Size([8, 2])
==========================================================================================================================================================================
Layer (type:depth-idx)                        Input Shape               Output Shape              Param #                   Kernel Shape              Mult-Adds
==========================================================================================================================================================================
CustomNeuralNet                               --                        --                        --                        --                        --
├─ResNet: 1-1                                 [8, 3, 256, 256]          [8, 2048]                 --                        --                        --
│    └─Sequential: 2-1                        [8, 3, 256, 256]          [8, 64, 128, 128]         --                        --                        --
│    │    └─Conv2d: 3-1                       [8, 3, 256, 256]          [8, 32, 128, 128]         864                       [3, 32, 3, 3]             113,246,208
│    │    └─BatchNorm2d: 3-2                  [8, 32, 128, 128]         [8, 32, 128, 128]         64                        [32]                      512
│    │    └─ReLU: 3-3                         [8, 32, 128, 128]         [8, 32, 128, 128]         --                        --                        --
│    │    └─Conv2d: 3-4                       [8, 32, 128, 128]         [8, 32, 128, 128]         9,216                     [32, 32, 3, 3]            1,207,959,552
│    │    └─BatchNorm2d: 3-5                  [8, 32, 128, 128]         [8, 32, 128, 128]         64                        [32]                      512
│    │    └─ReLU: 3-6                         [8, 32, 128, 128]         [8, 32, 128, 128]         --                        --                        --
│    │    └─Conv2d: 3-7                       [8, 32, 128, 128]         [8, 64, 128, 128]         18,432                    [32, 64, 3, 3]            2,415,919,104
│    └─BatchNorm2d: 2-2                       [8, 64, 128, 128]         [8, 64, 128, 128]         128                       [64]                      1,024
│    └─ReLU: 2-3                              [8, 64, 128, 128]         [8, 64, 128, 128]         --                        --                        --
│    └─MaxPool2d: 2-4                         [8, 64, 128, 128]         [8, 64, 64, 64]           --                        --                        --
│    └─Sequential: 2-5                        [8, 64, 64, 64]           [8, 256, 64, 64]          --                        --                        --
│    │    └─Bottleneck: 3-8                   [8, 64, 64, 64]           [8, 256, 64, 64]          75,008                    --                        2,415,929,344
│    │    └─Bottleneck: 3-9                   [8, 256, 64, 64]          [8, 256, 64, 64]          70,400                    --                        2,281,707,520
│    │    └─Bottleneck: 3-10                  [8, 256, 64, 64]          [8, 256, 64, 64]          70,400                    --                        2,281,707,520
│    └─Sequential: 2-6                        [8, 256, 64, 64]          [8, 512, 32, 32]          --                        --                        --
│    │    └─Bottleneck: 3-11                  [8, 256, 64, 64]          [8, 512, 32, 32]          379,392                   --                        3,892,334,592
│    │    └─Bottleneck: 3-12                  [8, 512, 32, 32]          [8, 512, 32, 32]          280,064                   --                        2,281,713,664
│    │    └─Bottleneck: 3-13                  [8, 512, 32, 32]          [8, 512, 32, 32]          280,064                   --                        2,281,713,664
│    │    └─Bottleneck: 3-14                  [8, 512, 32, 32]          [8, 512, 32, 32]          280,064                   --                        2,281,713,664
│    └─Sequential: 2-7                        [8, 512, 32, 32]          [8, 1024, 16, 16]         --                        --                        --
│    │    └─Bottleneck: 3-15                  [8, 512, 32, 32]          [8, 1024, 16, 16]         1,512,448                 --                        3,892,355,072
│    │    └─Bottleneck: 3-16                  [8, 1024, 16, 16]         [8, 1024, 16, 16]         1,117,184                 --                        2,281,725,952
│    │    └─Bottleneck: 3-17                  [8, 1024, 16, 16]         [8, 1024, 16, 16]         1,117,184                 --                        2,281,725,952
│    │    └─Bottleneck: 3-18                  [8, 1024, 16, 16]         [8, 1024, 16, 16]         1,117,184                 --                        2,281,725,952
│    │    └─Bottleneck: 3-19                  [8, 1024, 16, 16]         [8, 1024, 16, 16]         1,117,184                 --                        2,281,725,952
│    │    └─Bottleneck: 3-20                  [8, 1024, 16, 16]         [8, 1024, 16, 16]         1,117,184                 --                        2,281,725,952
│    └─Sequential: 2-8                        [8, 1024, 16, 16]         [8, 2048, 8, 8]           --                        --                        --
│    │    └─Bottleneck: 3-21                  [8, 1024, 16, 16]         [8, 2048, 8, 8]           6,039,552                 --                        3,892,396,032
│    │    └─Bottleneck: 3-22                  [8, 2048, 8, 8]           [8, 2048, 8, 8]           4,462,592                 --                        2,281,750,528
│    │    └─Bottleneck: 3-23                  [8, 2048, 8, 8]           [8, 2048, 8, 8]           4,462,592                 --                        2,281,750,528
│    └─SelectAdaptivePool2d: 2-9              [8, 2048, 8, 8]           [8, 2048]                 --                        --                        --
│    │    └─AdaptiveAvgPool2d: 3-24           [8, 2048, 8, 8]           [8, 2048, 1, 1]           --                        --                        --
│    │    └─Flatten: 3-25                     [8, 2048, 1, 1]           [8, 2048]                 --                        --                        --
│    └─Identity: 2-10                         [8, 2048]                 [8, 2048]                 --                        --                        --
├─Sequential: 1-2                             [8, 2048]                 [8, 2]                    --                        --                        --
│    └─Linear: 2-11                           [8, 2048]                 [8, 2]                    4,098                     [2048, 2]                 32,784
==========================================================================================================================================================================
Total params: 23,531,362
Trainable params: 23,531,362
Non-trainable params: 0
Total mult-adds (G): 45.21
==========================================================================================================================================================================
Input size (MB): 6.29
Forward/backward pass size (MB): 1992.29
Params size (MB): 94.13
Estimated Total Size (MB): 2092.71
==========================================================================================================================================================================
</code></pre></div>
<p>This model architechure means that if I pass in a batch of <span class="arithmatex">\(8\)</span> images of size <span class="arithmatex">\((3, 256, 256)\)</span>, the model statistics will tell us a lot of information. Let us give some examples with a naive <strong>ResNet50d</strong>.</p>
<ul>
<li>Input Shape: <span class="arithmatex">\([8, 3, 256, 256]\)</span> passing through the first <strong>Sequential Layer's Conv2d (3-1)</strong> with kernel size of</li>
<li>Kernel Shape: <span class="arithmatex">\([3, 32, 3, 3]\)</span> which means <span class="arithmatex">\([\textbf{in_channels, out_channels, kernel_size, kernel_size}]\)</span> will yield an output shape of</li>
<li>Output Shape: <span class="arithmatex">\([8, 32, 128, 128]\)</span> indicating that the each input images are now transformed into 32 kernels of size 256 by 256. </li>
<li>Params: The <strong>Params</strong> column calculates the number of parameters in this layer at 864 learnable parameters.</li>
</ul>
<hr />
<p>Once we know how to interpret the table, we can also see that our <code>CustomNeuralnet()</code> has <code>extract_features</code> which outputs the input at the last convolutional layer, in this example, it is at <strong>SelectAdaptivePool2d: 2-9</strong> where it first went through <strong>AdaptiveAvgPool2d: 3-24</strong> to squash the feature maps to <span class="arithmatex">\([8, 2048, 1, 1]\)</span> and subsequently a <strong>Flatten: 3-25</strong> layer to flatten out the last 2 dimensions to become <span class="arithmatex">\([8, 2048]\)</span> so we can pass on to the dense layers.</p>
<p>We can verify this by</p>
<div class="highlight"><pre><span></span><code><span class="n">X</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">randn</span><span class="p">((</span><span class="n">batch_size</span><span class="p">,</span> <span class="n">channel</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">width</span><span class="p">))</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="n">image</span><span class="o">=</span><span class="n">X</span><span class="p">)</span>
</code></pre></div>
<p>yielding</p>
<div class="highlight"><pre><span></span><code><span class="n">feature</span> <span class="n">logits</span> <span class="n">shape</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">Size</span><span class="p">([</span><span class="mi">8</span><span class="p">,</span> <span class="mi">2048</span><span class="p">])</span>
<span class="n">classifier_logits</span> <span class="n">shape</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">Size</span><span class="p">([</span><span class="mi">8</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
</code></pre></div>
<p>where the latter is the final shape of the input after passing through all the dense layers at <span class="arithmatex">\([8, 2]\)</span>, where one can envision it as 2 output neurons.</p>
<h2 id="error-analysis-using-grad-cam">Error Analysis using Grad-CAM</h2>
<p>There is some distinct difference when Grad-CAM is applied to different models, which can help us do error analysis.</p>
<figure>
<img src='https://storage.googleapis.com/reighns/reighns_ml_projects/docs/projects/SIIM-ISIC%20Melanoma%20Classification/images/resnet50d_image.PNG' width="800"/>
<figcaption align = "center"><b>Grad-CAM of ResNet50d</b></figcaption>
</figure>

<figure>
<img src='https://storage.googleapis.com/reighns/reighns_ml_projects/docs/projects/SIIM-ISIC%20Melanoma%20Classification/images/tf_efficientnet_b1_ns_image.PNG' width="800"/>
<figcaption align = "center"><b>Grad-CAM of EfficietNet</b></figcaption>
</figure>

<p>For more info on <a href="https://reighns92.github.io/reighns-ml-blog/reighns_ml_journey/deep_learning/computer_vision/general/neural_network_interpretation/05_gradcam_and_variants/gradcam_explained/">Grad-CAM</a>, see my blog post.</p>
<h2 id="next-steps">Next Steps</h2>
<ul>
<li>MLOps (Weights &amp; Biases for experiment tracking)</li>
<li>Model Persistence</li>
<li>Benefit Structure</li>
</ul>
<h2 id="references">References</h2>
<ul>
<li><a href="https://reighns92.github.io/reighns-ml-blog/reighns_ml_journey/deep_learning/computer_vision/general/image_normalization/Image_Normalization_and_Standardization/">Image Normalization</a></li>
<li><a href="https://www.kaggle.com/c/siim-isic-melanoma-classification/discussion/165526">Triple Stratified Leak-Free KFold CV</a></li>
<li><a href="https://pytorch.org/tutorials/beginner/transfer_learning_tutorial.html">Transfer Learning PyTorch</a></li>
<li><a href="https://www.tensorflow.org/tutorials/images/transfer_learning">Transfer Learning TensorFlow</a></li>
<li><a href="https://reighns92.github.io/reighns-ml-blog/reighns_ml_journey/deep_learning/fundamentals/loss_functions/cross_entropy_loss/cross_entropy_loss_from_scratch/">Cross-Entropy Loss</a></li>
<li><a href="https://reighns92.github.io/reighns-ml-blog/reighns_ml_journey/deep_learning/ensemble_theory/forward_ensemble/">Forward Ensemble</a></li>
<li><a href="https://www.kaggle.com/c/siim-isic-melanoma-classification/discussion/175614">Forward Ensemble Discussion</a></li>
<li><a href="https://reighns92.github.io/reighns-ml-blog/reighns_ml_journey/deep_learning/computer_vision/general/neural_network_interpretation/05_gradcam_and_variants/gradcam_explained/">Grad-CAM</a></li>
</ul>

              
            </article>
          </div>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        
        <a href="../../../RANZCR%20CLiP%20-%20Catheter%20and%20Line%20Position%20Challenge/notebooks/walkthrough/" class="md-footer__link md-footer__link--prev" aria-label="Previous: RANZCR CLiP - Catheter and Line Position Challenge" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              RANZCR CLiP - Catheter and Line Position Challenge
            </div>
          </div>
        </a>
      
      
        
        <a href="../../../LTA_road_cracks_detection/notebooks/walkthrough/" class="md-footer__link md-footer__link--next" aria-label="Next: LTA" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              LTA
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../../../../..", "features": ["content.code.annotate"], "search": "../../../../../assets/javascripts/workers/search.2a1c317c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
    
    
      <script src="../../../../../assets/javascripts/bundle.ed9748b7.min.js"></script>
      
        <script src="../../../../../javascript/mathjax.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>